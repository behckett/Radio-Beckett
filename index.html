<div id="player-container" style="max-width:600px; margin:auto; font-family: Tahoma, sans-serif;"></div>

<script>
  const rssUrl = "https://anchor.fm/s/103cea30c/podcast/rss";

  // لینک های اختصاصی و کاور اختصاصی برای سه اپیزود آخر
  const specialEpisodes = {
    "25": {
      url: "https://spotifycreators-web.app.link/e/MsHbzp6DqTb",
      cover: "https://i.scdn.co/image/ab6765630000ba8a8e0998c6221e44bc6d3a61e2"
    },
    "24": {
      url: "https://spotifycreators-web.app.link/e/NLXVQq6DqTb",
      cover: "https://i.scdn.co/image/ab6765630000ba8afc998cc6221e44bc6d3a62f0"
    },
    "23": {
      url: "https://spotifycreators-web.app.link/e/UIkqas6DqTb",
      cover: "https://i.scdn.co/image/ab6765630000ba8a7c1238c6221e44bc6d3a600a"
    }
  };

  async function loadEpisodes() {
    const container = document.getElementById("player-container");
    container.innerHTML = "<p>در حال بارگذاری...</p>";

    try {
      const res = await fetch(rssUrl);
      const rssText = await res.text();
      const parser = new DOMParser();
      const xml = parser.parseFromString(rssText, "application/xml");

      // کاور کلی پادکست
      const channelImage = xml.querySelector('channel > itunes\\:image')?.getAttribute('href') || "";

      const items = xml.querySelectorAll("item");

      container.innerHTML = ""; // پاک کردن متن بارگذاری

      items.forEach((item) => {
        const title = item.querySelector("title")?.textContent || "بدون عنوان";
        const enclosure = item.querySelector("enclosure");
        const audioUrl = enclosure?.getAttribute("url") || "";
        const episodeNumber = getEpisodeNumber(title);

        // اگر اپیزود در specialEpisodes هست کاور و لینک اختصاصی بگیر
        let coverUrl = channelImage;
        let episodeLink = audioUrl;

        if (episodeNumber && specialEpisodes[episodeNumber]) {
          coverUrl = specialEpisodes[episodeNumber].cover;
          episodeLink = specialEpisodes[episodeNumber].url;
        }

        // ساختار هر اپیزود
        const episodeDiv = document.createElement("div");
        episodeDiv.className = "episode";
        episodeDiv.style.display = "flex";
        episodeDiv.style.alignItems = "center";
        episodeDiv.style.gap = "12px";
        episodeDiv.style.marginBottom = "20px";
        episodeDiv.style.borderBottom = "1px solid #ddd";
        episodeDiv.style.paddingBottom = "10px";

        episodeDiv.innerHTML = `
          <img src="${coverUrl}" alt="کاور اپیزود ${episodeNumber || ''}" style="width:70px; height:70px; object-fit:cover; border-radius:10px;">
          <div style="flex:1; text-align:right;">
            <h3 style="margin:0 0 8px 0; font-weight: 600;">${title}</h3>
            <audio controls src="${episodeLink}" style="width:100%; border-radius:8px;"></audio>
          </div>
        `;

        container.appendChild(episodeDiv);
      });

    } catch (error) {
      container.innerHTML = "<p>خطا در بارگذاری اپیزودها. لطفا بعدا تلاش کنید.</p>";
      console.error(error);
    }
  }

  // استخراج شماره اپیزود از عنوان (اعداد داخل عنوان)
  function getEpisodeNumber(title) {
    const match = title.match(/(\d+)/);
    return match ? match[1] : null;
  }

  loadEpisodes();
</script>
